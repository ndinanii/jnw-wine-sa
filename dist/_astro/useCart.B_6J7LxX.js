import{r as o}from"./index.DiEladB3.js";const l="jnw-cart-v1",f=24,u="jnw-cart-sync",w=155;function y(n){if(!n)return[];try{const a=JSON.parse(n);return Array.isArray(a)?a.map(s=>({...s,price:w.toFixed(2),currencyCode:"ZAR"})):[]}catch{return[]}}function m(){const[n,a]=o.useState([]),[s,d]=o.useState("idle");o.useEffect(()=>{a(y(localStorage.getItem(l)))},[]),o.useEffect(()=>{localStorage.setItem(l,JSON.stringify(n)),window.dispatchEvent(new CustomEvent(u,{detail:n}))},[n]),o.useEffect(()=>{function e(t){t.key===l&&a(y(t.newValue))}function r(t){const c=Array.isArray(t.detail)?t.detail:[];a(i=>JSON.stringify(i)===JSON.stringify(c)?i:c)}return window.addEventListener("storage",e),window.addEventListener(u,r),()=>{window.removeEventListener("storage",e),window.removeEventListener(u,r)}},[]);const h=o.useCallback((e,r)=>{e?.id&&a(t=>{const c=t.findIndex(i=>i.variantId===e.id);return c===-1?[...t,{variantId:e.id,qty:1,title:r.title,variantTitle:e.title,price:w.toFixed(2),currencyCode:"ZAR"}]:t.map((i,g)=>g===c?{...i,qty:Math.min(f,i.qty+1)}:i)})},[]),C=o.useCallback(e=>{a(r=>r.map(t=>t.variantId===e?{...t,qty:Math.min(f,t.qty+1)}:t))},[]),p=o.useCallback(e=>{a(r=>r.map(t=>t.variantId===e?{...t,qty:Math.max(0,t.qty-1)}:t).filter(t=>t.qty>0))},[]),E=o.useCallback(async()=>{if(n.length){d("loading");try{const e=await fetch("/api/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lineItems:n})}),r=await e.json();if(!e.ok)throw new Error(r.error||"Checkout failed");r.webUrl&&(window.location.href=r.webUrl)}catch(e){console.error(e),d("error"),alert("Checkout could not be started. Please try again.")}finally{d("idle")}}},[n]),S=n.reduce((e,r)=>e+r.qty,0);return{cart:n,totalItems:S,checkoutState:s,addToCart:h,increment:C,decrement:p,checkout:E}}export{m as u};
