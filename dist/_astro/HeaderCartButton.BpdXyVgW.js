import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as s}from"./index.DiEladB3.js";import{u as R}from"./useCart.KY0El3nN.js";const P="jnw-checkout-compliance-v1";function z(a){if(!a)return null;try{const n=JSON.parse(a);return!n||typeof n!="object"?null:{ageConfirmed:!!n.ageConfirmed,deliveryPolicyAccepted:!!n.deliveryPolicyAccepted,returnsPolicyAccepted:!!n.returnsPolicyAccepted,postalCode:typeof n.postalCode=="string"?n.postalCode:"",phone:typeof n.phone=="string"?n.phone:""}}catch{return null}}function O(a){return String(a||"").toUpperCase().replace(/[^A-Z0-9 -]/g,"").trim().slice(0,10)}function D(a){return String(a||"").replace(/\D/g,"").slice(0,15)}function q(a){return/^[A-Z0-9][A-Z0-9 -]{2,9}$/.test(a)}function B(a){const n=a.replace(/\D/g,"");return n.length>=9&&n.length<=15}function M({cart:a,onIncrement:n,onDecrement:m,onCheckout:y,checkoutState:i,sticky:g=!0}){const[l,o]=s.useState(!1),[r,d]=s.useState(!1),[p,f]=s.useState(!1),[u,j]=s.useState(""),[h,v]=s.useState("");s.useEffect(()=>{let t=null;try{t=z(localStorage.getItem(P))}catch{t=null}t&&(o(t.ageConfirmed),d(t.deliveryPolicyAccepted),f(t.returnsPolicyAccepted),j(t.postalCode),v(t.phone))},[]),s.useEffect(()=>{const t={ageConfirmed:l,deliveryPolicyAccepted:r,returnsPolicyAccepted:p,postalCode:u,phone:h};try{localStorage.setItem(P,JSON.stringify(t))}catch{}},[l,r,p,u,h]);const C=s.useMemo(()=>a.reduce((t,c)=>t+c.qty,0),[a]),A=s.useMemo(()=>a.reduce((t,c)=>t+parseFloat(c.price||0)*c.qty,0),[a]),b=O(u),k=D(h),N=q(b),S=B(k),w=l&&r&&p&&N&&S,x=!a.length||i==="loading"||!w;function E(){x||y({compliance:{ageConfirmed:!0,deliveryPolicyAccepted:!0,returnsPolicyAccepted:!0},addressCheck:{postalCode:b,phone:k}})}const F=`${g?"cart-sidebar ":""}glass-strong`.trim();return e.jsxs("aside",{className:F,style:{padding:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"8px"},children:[e.jsx("h2",{style:{margin:0,fontSize:"1.3rem"},children:"Cart"}),e.jsxs("span",{className:"badge",children:[C," ",C===1?"item":"items"]})]}),e.jsx("hr",{className:"gold-divider",style:{margin:"12px 0"}}),a.length===0?e.jsx("p",{style:{margin:0,fontFamily:"Inter, sans-serif",fontSize:"0.85rem",color:"var(--color-text-muted)"},children:"Your cart is empty"}):e.jsx("ul",{style:{listStyle:"none",margin:0,padding:0,display:"grid",gap:"8px"},children:a.map(t=>{const I=t.variantTitle&&!/^default title$/i.test(t.variantTitle.trim())?t.variantTitle:t.vintage?`Vintage ${t.vintage}`:"";return e.jsxs("li",{style:{borderRadius:"var(--radius-sm)",border:"1px solid rgba(197,164,90,0.12)",padding:"12px",background:"rgba(197,164,90,0.03)"},children:[e.jsx("p",{style:{margin:"0 0 2px",fontFamily:"Inter, sans-serif",fontSize:"0.82rem"},children:t.title}),e.jsxs("p",{style:{margin:"0 0 10px",fontFamily:"Inter, sans-serif",fontSize:"0.72rem",color:"var(--color-text-muted)"},children:[I,t.price?`${I?" - ":""}R${parseFloat(t.price).toFixed(2)} per bottle`:""]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("button",{type:"button",className:"qty-btn",onClick:()=>m(t.variantId),children:"-"}),e.jsx("span",{style:{minWidth:"20px",textAlign:"center",fontFamily:"Inter, sans-serif",fontSize:"0.82rem"},children:t.qty}),e.jsx("button",{type:"button",className:"qty-btn",onClick:()=>n(t.variantId),children:"+"})]})]},t.variantId)})}),a.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"gold-divider",style:{margin:"12px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"12px"},children:[e.jsx("span",{style:{fontFamily:"Inter, sans-serif",fontSize:"0.75rem",color:"var(--color-text-muted)"},children:"Estimated total"}),e.jsxs("strong",{style:{color:"var(--color-gold-soft)"},children:["R",A.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{className:"checkout-compliance-card",children:[e.jsx("p",{className:"checkout-compliance-heading",children:"Before Checkout"}),e.jsxs("label",{className:"checkout-check",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:t=>o(t.target.checked)}),e.jsx("span",{children:"I confirm I am 18 years or older and legally allowed to purchase alcohol."})]}),e.jsxs("label",{className:"checkout-check",children:[e.jsx("input",{type:"checkbox",checked:r,onChange:t=>d(t.target.checked)}),e.jsx("span",{children:"I accept delivery terms: valid ID required, no delivery to minors, no unattended drop-offs."})]}),e.jsxs("label",{className:"checkout-check",children:[e.jsx("input",{type:"checkbox",checked:p,onChange:t=>f(t.target.checked)}),e.jsx("span",{children:"I understand returns are for unopened approved returns and damaged/incorrect items reported quickly."})]}),e.jsxs("div",{className:"address-check-grid",children:[e.jsxs("label",{children:["Postal code",e.jsx("input",{type:"text",value:u,onChange:t=>j(t.target.value),placeholder:"e.g. 4001",autoComplete:"postal-code"})]}),e.jsxs("label",{children:["Mobile number",e.jsx("input",{type:"tel",value:h,onChange:t=>v(t.target.value),placeholder:"e.g. 0821234567",autoComplete:"tel"})]})]}),e.jsx("p",{className:"checkout-compliance-note",children:"Address pre-check helps reduce failed deliveries. Please use your final delivery contact details."}),e.jsxs("p",{className:"checkout-compliance-error",children:[N?"":"Enter a valid postal code. ",S?"":"Enter a reachable phone number."]})]})]}),e.jsx("button",{type:"button",disabled:x,onClick:E,className:"btn-gold",style:{width:"100%",padding:"10px",opacity:x?.45:1},children:i==="loading"?"Redirecting...":"Checkout"})]})}function L(){const{cart:a,totalItems:n,checkoutState:m,increment:y,decrement:i,checkout:g}=R(),[l,o]=s.useState(!1);return s.useEffect(()=>{const r=document.body.style.overflow;return l?document.body.style.overflow="hidden":document.body.style.overflow=r||"",()=>{document.body.style.overflow=r||""}},[l]),s.useEffect(()=>{function r(d){d.key==="Escape"&&o(!1)}return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[]),e.jsxs("div",{className:"header-cart-wrap",children:[e.jsxs("button",{type:"button",className:"icon-link cart-trigger","aria-label":`Cart (${n} items)`,onClick:()=>o(!0),children:[e.jsxs("svg",{viewBox:"0 0 24 24","aria-hidden":"true",children:[e.jsx("path",{d:"M5 7h14l-1.4 8.2a2 2 0 0 1-2 1.7H8.4a2 2 0 0 1-2-1.7L5 7Z"}),e.jsx("path",{d:"M9 7V5a3 3 0 0 1 6 0v2"})]}),n>0&&e.jsx("span",{className:"header-cart-badge",children:n>99?"99+":n})]}),l&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"header-cart-overlay","aria-label":"Close cart",onClick:()=>o(!1)}),e.jsxs("aside",{className:"header-cart-panel","aria-label":"Shopping cart panel",children:[e.jsxs("div",{className:"header-cart-panel-head",children:[e.jsx("p",{children:"Cart"}),e.jsx("button",{type:"button",className:"header-cart-close","aria-label":"Close cart",onClick:()=>o(!1),children:"x"})]}),e.jsx("div",{className:"header-cart-panel-body",children:e.jsx(M,{cart:a,onIncrement:y,onDecrement:i,onCheckout:g,checkoutState:m,sticky:!1})})]})]})]})}export{L as default};
