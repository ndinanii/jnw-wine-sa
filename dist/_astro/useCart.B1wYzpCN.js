import{r as a}from"./index.DiEladB3.js";const d="jnw-cart-v1",u=24,l="jnw-cart-sync";function y(n){if(!n)return[];try{const o=JSON.parse(n);return Array.isArray(o)?o:[]}catch{return[]}}function m(){const[n,o]=a.useState([]),[f,i]=a.useState("idle");a.useEffect(()=>{o(y(localStorage.getItem(d)))},[]),a.useEffect(()=>{localStorage.setItem(d,JSON.stringify(n)),window.dispatchEvent(new CustomEvent(l,{detail:n}))},[n]),a.useEffect(()=>{function t(e){e.key===d&&o(y(e.newValue))}function r(e){const s=Array.isArray(e.detail)?e.detail:[];o(c=>JSON.stringify(c)===JSON.stringify(s)?c:s)}return window.addEventListener("storage",t),window.addEventListener(l,r),()=>{window.removeEventListener("storage",t),window.removeEventListener(l,r)}},[]);const w=a.useCallback((t,r)=>{t?.id&&o(e=>{const s=e.findIndex(c=>c.variantId===t.id);return s===-1?[...e,{variantId:t.id,qty:1,title:r.title,variantTitle:t.title,price:t.price?.amount??t.priceV2?.amount,currencyCode:t.price?.currencyCode??t.priceV2?.currencyCode??"ZAR"}]:e.map((c,S)=>S===s?{...c,qty:Math.min(u,c.qty+1)}:c)})},[]),h=a.useCallback(t=>{o(r=>r.map(e=>e.variantId===t?{...e,qty:Math.min(u,e.qty+1)}:e))},[]),p=a.useCallback(t=>{o(r=>r.map(e=>e.variantId===t?{...e,qty:Math.max(0,e.qty-1)}:e).filter(e=>e.qty>0))},[]),C=a.useCallback(async()=>{if(n.length){i("loading");try{const t=await fetch("/api/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lineItems:n})}),r=await t.json();if(!t.ok)throw new Error(r.error||"Checkout failed");r.webUrl&&(window.location.href=r.webUrl)}catch(t){console.error(t),i("error"),alert("Checkout could not be started. Please try again.")}finally{i("idle")}}},[n]),E=n.reduce((t,r)=>t+r.qty,0);return{cart:n,totalItems:E,checkoutState:f,addToCart:w,increment:h,decrement:p,checkout:C}}export{m as u};
